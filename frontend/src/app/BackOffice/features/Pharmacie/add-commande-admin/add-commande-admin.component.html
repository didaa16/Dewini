<div class="container mt-5">
  <div class="card shadow-lg border-0 rounded-4 p-4">
    <h4 class="mb-4 text-success fw-bold">
      <i class="bi bi-plus-circle-fill me-2"></i> Ajouter une commande
    </h4>

    <form #commandeForm="ngForm" (ngSubmit)="addCommande()">
      
      <!-- ğŸ§ Nom du patient -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-person-fill me-1 text-primary"></i> Nom du patient
        </label>
        <input 
          type="text" 
          class="form-control"
          [(ngModel)]="newCommande.nomClient"
          name="nomClient"
          required
          minlength="4"
          #nomClient="ngModel"
          placeholder="Entrez le nom du client"
          [ngClass]="{
            'is-valid': nomClient.valid && nomClient.touched,
            'is-invalid': nomClient.invalid && nomClient.touched
          }"
        />
        <div *ngIf="nomClient.errors?.['required'] && nomClient.touched" class="text-danger small mt-1">
          âŒ Le nom est requis.
        </div>
        <div *ngIf="nomClient.errors?.['minlength'] && nomClient.touched" class="text-danger small mt-1">
          âŒ Le nom doit contenir au moins 4 caractÃ¨res.
        </div>
      </div>

      <!-- ğŸ“ Adresse -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-geo-alt-fill me-1 text-danger"></i> Adresse
        </label>
        <input 
          type="text" 
          class="form-control"
          [(ngModel)]="newCommande.adresse"
          name="adresse"
          required
          minlength="5"
          #adresse="ngModel"
          placeholder="Adresse de livraison"
          [ngClass]="{
            'is-valid': adresse.valid && adresse.touched,
            'is-invalid': adresse.invalid && adresse.touched
          }"
        />
        <div *ngIf="adresse.errors?.['required'] && adresse.touched" class="text-danger small mt-1">
          âŒ L'adresse est requise.
        </div>
        <div *ngIf="adresse.errors?.['minlength'] && adresse.touched" class="text-danger small mt-1">
          âŒ L'adresse doit contenir au moins 5 caractÃ¨res.
        </div>
      </div>

      <!-- â³ Ã‰tat -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-hourglass-split me-1 text-warning"></i> Ã‰tat de la commande
        </label>
        <select 
          class="form-select"
          [(ngModel)]="newCommande.etat"
          name="etat"
          required
          #etat="ngModel"
          [ngClass]="{
            'is-valid': etat.valid && etat.touched,
            'is-invalid': etat.invalid && etat.touched
          }"
        >
          <option [ngValue]="null" disabled>-- SÃ©lectionner l'Ã©tat --</option>
          <option value="EN_COURS">ğŸŸ¡ En cours</option>
          <option value="LIVREE">ğŸŸ¢ LivrÃ©e</option>
          <option value="ANNULEE">ğŸ”´ AnnulÃ©e</option>
        </select>
        <div *ngIf="etat.errors?.['required'] && etat.touched" class="text-danger small mt-1">
          âŒ L'Ã©tat de la commande est requis.
        </div>
      </div>

      <!-- ğŸ’Š MÃ©dicaments -->
      <div class="mb-3">
        <label class="form-label fw-semibold">
          <i class="bi bi-capsule me-1 text-success"></i> MÃ©dicaments
        </label>
        <select 
          class="form-select"
          multiple
          [(ngModel)]="selectedMedicaments"
          name="selectedMedicaments"
          #selectedMedicamentsField="ngModel"
          [ngClass]="{
            'is-valid': selectedMedicaments.length > 0 && selectedMedicamentsField.touched,
            'is-invalid': selectedMedicaments.length == 0 && selectedMedicamentsField.touched
          }"
        >
          <option *ngFor="let med of allMedicaments" [value]="med.id">
            {{ med.nom }}
          </option>
        </select>
        <small class="text-muted">Maintenez Ctrl (Windows) ou Cmd (Mac) pour sÃ©lectionner plusieurs.</small>
        <div *ngIf="selectedMedicaments.length == 0 && selectedMedicamentsField.touched" class="text-danger small mt-1">
          âŒ Veuillez sÃ©lectionner au moins un mÃ©dicament.
        </div>
      </div>

      <!-- Boutons -->
      <div class="text-end mt-4">
        <button type="submit" class="btn btn-success px-4" [disabled]="commandeForm.invalid || selectedMedicaments.length === 0">
          âœ… Enregistrer
        </button>
        <a routerLink="/dashboard/commandes" class="btn btn-outline-secondary ms-2 px-4">
          â†© Retour
        </a>
      </div>
    </form>

    <!-- âœ… Toast ajout rÃ©ussi -->
    <div *ngIf="toastVisible" class="toast align-items-center text-bg-success border-0 show position-fixed bottom-0 end-0 m-4 shadow-lg" role="alert">
      <div class="d-flex">
        <div class="toast-body fw-semibold">
          âœ… Commande ajoutÃ©e avec succÃ¨s !
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" (click)="toastVisible = false"></button>
      </div>
    </div>

  </div>
</div>
