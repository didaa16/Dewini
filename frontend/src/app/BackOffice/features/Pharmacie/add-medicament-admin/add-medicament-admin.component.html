<div class="container mt-4">
  <h2 class="text-success mb-4">‚ûï Ajouter un M√©dicament</h2>

  <form #medicamentForm="ngForm" (ngSubmit)="onSubmit()" enctype="multipart/form-data" class="shadow p-4 bg-white rounded-4">

    <!-- üßæ Nom -->
    <div class="mb-3">
      <label class="form-label fw-semibold">Nom du m√©dicament</label>
      <input 
      class="form-control"
      [(ngModel)]="medicament.nom"
      name="nom"
      required
      minlength="4"
      #nom="ngModel"
      [ngClass]="{
        'is-valid': nom.valid && nom.touched,
        'is-invalid': nom.invalid && nom.touched
      }"
    />
    
      <div *ngIf="nom.errors?.['required'] && nom.touched" class="text-danger small mt-1">
        ‚ùå Le nom est requis.
      </div>
      <div *ngIf="nom.errors?.['minlength'] && nom.touched" class="text-danger small mt-1">
        ‚ùå Le nom doit faire au moins 4 caract√®res.
      </div>
    </div>
    

    <!-- üìù Description -->
    <div class="mb-3">
      <label class="form-label fw-semibold">Description</label>
      <textarea 
        class="form-control"
        [(ngModel)]="medicament.description"
        name="description"
        rows="3"
        required
        #description="ngModel"
      ></textarea>
      <div *ngIf="description.invalid && description.touched" class="text-danger small mt-1">
        ‚ùå La description est requise.
      </div>
    </div>

    <div class="row">
      <!-- üì¶ Quantit√© -->
      <div class="col-md-4 mb-3">
        <label class="form-label fw-semibold">Quantit√© en stock</label>
        <input 
          type="number"
          class="form-control"
          [(ngModel)]="medicament.quantiteEnStock"
          name="quantiteEnStock"
          required
          min="1"
          #quantiteEnStock="ngModel"
        />
        <div *ngIf="quantiteEnStock.invalid && quantiteEnStock.touched" class="text-danger small mt-1">
          ‚ùå Quantit√© valide requise (‚â• 1).
        </div>
      </div>

      <!-- üí∞ Prix -->
      <div class="col-md-4 mb-3">
        <label class="form-label fw-semibold">Prix (TND)</label>
        <input 
          type="number"
          class="form-control"
          [(ngModel)]="medicament.prix"
          name="prix"
          required
          min="0"
          #prix="ngModel"
        />
        <div *ngIf="prix.invalid && prix.touched" class="text-danger small mt-1">
          ‚ùå Prix valide requis.
        </div>
      </div>

      <!-- üìÖ Date Expiration -->
      <div class="col-md-4 mb-3">
        <label class="form-label fw-semibold">Date d‚Äôexpiration</label>
        <input 
          type="date"
          class="form-control"
          [(ngModel)]="medicament.dateExpiration"
          name="dateExpiration"
          required
          #dateExpiration="ngModel"
        />
        <div *ngIf="dateExpiration.invalid && dateExpiration.touched" class="text-danger small mt-1">
          ‚ùå Date d'expiration requise.
        </div>
      </div>
    </div>

    <!-- üè∑Ô∏è Cat√©gorie -->
    <div class="mb-3">
      <label class="form-label fw-semibold">Cat√©gorie</label>
      <select 
        class="form-select"
        [(ngModel)]="medicament.categorie"
        name="categorie"
        required
        #categorie="ngModel"
      >
        <option [ngValue]="null" disabled>-- Choisir une cat√©gorie --</option>
        <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
      </select>
      <div *ngIf="categorie.invalid && categorie.touched" class="text-danger small mt-1">
        ‚ùå Cat√©gorie requise.
      </div>
    </div>

    <!-- üñºÔ∏è Image -->
    <div class="mb-3">
      <label class="form-label fw-semibold">Image</label>
      <input 
        type="file"
        class="form-control"
        (change)="onFileSelected($event)"
        accept="image/*"
      />
      <div *ngIf="imageError" class="text-danger small mt-1">
        ‚ùå {{ imageError }}
      </div>
    </div>

    <!-- üñºÔ∏è Preview -->
    <div *ngIf="previewUrl" class="mb-3">
      <img [src]="previewUrl" alt="Preview" class="img-thumbnail" style="max-height: 200px;" />
    </div>

    <!-- üì∂ Progression -->
    <div class="progress mb-3" *ngIf="uploadProgress > 0 && uploadProgress < 100">
      <div class="progress-bar bg-success" role="progressbar" [style.width.%]="uploadProgress" aria-valuemin="0" aria-valuemax="100">
        {{ uploadProgress }}%
      </div>
    </div>

    <!-- ‚úÖ Bouton Envoi -->
    <div class="text-end">
      <button type="submit" class="btn btn-success px-4" [disabled]="medicamentForm.invalid || !selectedFile">‚úÖ Ajouter</button>
    </div>

  </form>
</div>
